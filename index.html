<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutti Frutti Pro - El loco de la mochila</title>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #ec4899;
            --success: #22c55e;
            --error: #ef4444;
            --warning: #f59e0b;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text: #1f2937;
            --text-muted: #6b7280;
            
            /* Colores de columnas de tabla */
            --col1: #fee2e2; --col1-t: #991b1b;
            --col2: #fef3c7; --col2-t: #92400e;
            --col3: #dcfce7; --col3-t: #166534;
            --col4: #d1fae5; --col4-t: #065f46;
            --col5: #dbeafe; --col5-t: #1e40af;
            --col6: #e0e7ff; --col6-t: #3730a3;
            --col7: #ede9fe; --col7-t: #5b21b6;
            --col8: #fae8ff; --col8-t: #86198f;
            --col9: #fce7f3; --col9-t: #9d174d;
            --col10: #ffedd5; --col10-t: #9a3412;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        body {
            background-color: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 10px;
        }

        .container {
            width: 100%;
            max-width: 900px; /* Ancho ampliado para tablas */
            background: var(--card-bg);
            margin: auto;
            padding: 1.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        header { text-align: center; margin-bottom: 1rem; }
        h1 { color: var(--primary); font-size: 2rem; }
        
        .hidden { display: none !important; }
        .flex { display: flex; gap: 10px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        
        .btn {
            padding: 0.8rem;
            border: 2px solid transparent;
            border-radius: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-outline { background: #fff; border: 2px solid #e5e7eb; color: var(--text-muted); }
        .btn.active-selection {
            border-color: var(--primary);
            background-color: #eef2ff;
            color: var(--primary);
            transform: scale(1.02);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .btn-stop { background: var(--error); color: white; width: 100%; margin-top: 15px; font-size: 1.3rem; padding: 1rem; }

        /* Estilo de la Tabla */
        .table-wrapper {
            width: 100%;
            overflow-x: auto;
            margin: 1rem 0;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            border: 2px solid #e5e7eb;
        }
        .category-table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            min-width: 600px; /* Asegura legibilidad en scroll */
        }
        .category-table th {
            padding: 12px 8px;
            text-align: center;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 3px solid rgba(0,0,0,0.1);
        }
        .category-table td {
            padding: 15px 10px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9rem;
            border-right: 1px solid rgba(0,0,0,0.05);
        }

        /* Colores din√°micos por columna */
        .col-0 { background-color: var(--col1); color: var(--col1-t); }
        .col-1 { background-color: var(--col2); color: var(--col2-t); }
        .col-2 { background-color: var(--col3); color: var(--col3-t); }
        .col-3 { background-color: var(--col4); color: var(--col4-t); }
        .col-4 { background-color: var(--col5); color: var(--col5-t); }
        .col-5 { background-color: var(--col6); color: var(--col6-t); }
        .col-6 { background-color: var(--col7); color: var(--col7-t); }
        .col-7 { background-color: var(--col8); color: var(--col8-t); }
        .col-8 { background-color: var(--col9); color: var(--col9-t); }
        .col-9 { background-color: var(--col10); color: var(--col10-t); }

        .example-row td {
            font-style: italic;
            font-weight: normal;
            font-size: 0.8rem;
            padding: 8px;
            border-top: 1px dashed rgba(0,0,0,0.1);
        }

        .scoreboard {
            background: #f9fafb;
            padding: 1rem;
            border-radius: 1rem;
            margin-bottom: 1rem;
            border: 2px solid #e5e7eb;
        }
        .score-entry {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #eee;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--primary);
            color: white;
            padding: 1rem;
            border-radius: 1rem;
            margin-bottom: 1rem;
        }
        .big-letter { font-size: 3rem; font-weight: 900; }

        .scoring-rules {
            background: #fffbeb;
            border: 1px solid #fde68a;
            padding: 0.8rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            font-size: 0.8rem;
        }

        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex; align-items: center; justify-content: center; z-index: 100;
        }
        .modal-content {
            background: white; padding: 2rem; border-radius: 1rem; max-width: 90%; max-height: 80vh; overflow-y: auto;
        }

        footer {
            margin-top: 1.5rem; text-align: center; font-size: 0.8rem; color: var(--text-muted);
        }
        footer a { color: var(--primary); text-decoration: none; font-weight: bold; }

        .animate-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Tutti Frutti 2026</h1>
        <div id="active-players-summary" class="hidden scoreboard"></div>
    </header>

    <!-- PANTALLA 1: CONFIGURACI√ìN -->
    <div id="view-setup" class="flex" style="flex-direction: column; gap:1.2rem">
        <button class="btn btn-outline" onclick="toggleModal(true)">üìñ Instrucciones de Uso</button>
        
        <div>
            <label><strong>1. Jugadores</strong></label>
            <div class="flex" style="margin-top:5px">
                <input type="text" id="player-name-input" style="flex:1; padding:0.7rem; border:2px solid #e5e7eb; border-radius:0.5rem" placeholder="A√±adir nombre...">
                <button class="btn btn-primary" onclick="addPlayer()">+</button>
            </div>
            <div id="player-list" style="margin-top:10px; display: flex; flex-wrap: wrap; gap: 8px;"></div>
        </div>

        <div>
            <label><strong>2. Modo de Juego</strong></label>
            <div class="grid-2" style="margin-top:5px">
                <button id="mode-app" class="btn btn-outline" onclick="setMode('app')">üì± App</button>
                <button id="mode-paper" class="btn btn-outline" onclick="setMode('paper')">üìù Papel</button>
            </div>
        </div>

        <div>
            <label><strong>3. Dificultad</strong></label>
            <div class="grid-2" style="margin-top:5px">
                <button id="diff-easy" class="btn btn-outline" onclick="setDiff('easy')">üü¢ F√°cil</button>
                <button id="diff-hard" class="btn btn-outline" onclick="setDiff('hard')">üî¥ Dif√≠cil</button>
            </div>
        </div>

        <div id="preview-section">
            <label><strong>Vista previa de categor√≠as:</strong></label>
            <div class="table-wrapper">
                <table class="category-table" id="table-setup-preview"></table>
            </div>
        </div>

        <button class="btn btn-secondary animate-pulse" style="font-size: 1.1rem;" onclick="startRound()">¬°EMPEZAR RONDA!</button>
    </div>

    <!-- PANTALLA 2: JUEGO -->
    <div id="view-game" class="hidden">
        <div class="status-bar">
            <div>
                <small>LETRA</small>
                <div id="display-letter" class="big-letter">?</div>
            </div>
            <div style="text-align:right">
                <small>CRON√ìMETRO</small>
                <div id="display-timer" style="font-size: 1.5rem; font-weight: bold;">00s</div>
            </div>
        </div>

        <div class="table-wrapper">
            <table class="category-table" id="active-game-table"></table>
        </div>

        <div id="game-inputs-container" class="grid-2" style="margin-top:15px">
            <!-- Inputs din√°micos si es modo App -->
        </div>

        <button class="btn btn-stop" onclick="stopGame()">¬°BASTA!</button>
    </div>

    <!-- PANTALLA 3: PUNTUACI√ìN -->
    <div id="view-scoring" class="hidden">
        <h2 style="text-align:center; margin-bottom:1rem">Validaci√≥n de Puntos</h2>
        
        <div class="scoring-rules">
            <strong>üìè Reglas:</strong> 20 pts (√önico), 10 pts (V√°lida), 5 pts (Repetida), 0 pts (Error).
        </div>

        <div class="table-wrapper">
            <table class="category-table" id="scoring-table-examples">
                <!-- Se llenar√° con categor√≠as y ejemplos -->
            </table>
        </div>
        
        <div id="players-scoring-list"></div>

        <div class="grid-2" style="margin-top: 15px;">
            <button class="btn btn-primary" onclick="savePointsAndNext()">Nueva Ronda</button>
            <button class="btn btn-secondary" onclick="finishGame()">Finalizar Partida</button>
        </div>
    </div>

    <!-- PANTALLA 4: RESULTADOS -->
    <div id="view-winner" class="hidden" style="text-align:center">
        <h2 style="color:var(--success); font-size: 1.8rem;">üèÜ Clasificaci√≥n Final</h2>
        <div id="final-rankings" style="margin: 20px 0; text-align: left;"></div>
        <button class="btn btn-primary" style="width:100%" onclick="restartEverything()">VOLVER AL INICIO</button>
    </div>
</div>

<!-- MODAL AYUDA -->
<div id="modal-help" class="modal hidden">
    <div class="modal-content">
        <h3>Manual de Tutti Frutti</h3>
        <p style="margin: 10px 0;"><strong>1. Registro:</strong> A√±ade a los jugadores y elige modo.</p>
        <p style="margin: 10px 0;"><strong>2. Modo Papel:</strong> La app muestra la tabla de colores para que copi√©is las columnas en vuestros folios.</p>
        <p style="margin: 10px 0;"><strong>3. Partida:</strong> Escribid r√°pido. El primero en terminar pulsa ¬°Basta!.</p>
        <p style="margin: 10px 0;"><strong>4. Puntos:</strong> Consultad la tabla con <strong>ejemplos sugeridos</strong> para validar vuestras respuestas.</p>
        <button class="btn btn-primary" style="width:100%" onclick="toggleModal(false)">¬°A jugar!</button>
    </div>
</div>

<footer>
    Elaborada en 2026 por <a href="https://blogsaverroes.juntadeandalucia.es/ellocodelamochila" target="_blank">El loco de la mochila</a>
</footer>

<script>
    const CATS_DATA = {
        easy: ['Nombre', 'Animal', 'Lugar', 'Comida', 'Cosa'],
        hard: ['Nombre', 'Animal', 'Lugar', 'Comida', 'Cosa', 'Color', 'Apellido', 'Ficci√≥n', 'Famoso', 'Historia']
    };
    
    const EXAMPLES_DATA = {
        'A': ['Ana', '√Åguila', 'Almer√≠a', 'Arroz', 'Anillo', 'Azul', 'Alarc√≥n', 'Asterix', 'Alejandro Sanz', 'Arist√≥teles'],
        'B': ['Beatriz', 'Ballena', 'B√©lgica', 'Burrito', 'Botella', 'Blanco', 'Ben√≠tez', 'Batman', 'Beyonc√©', 'Bol√≠var'],
        'C': ['Carlos', 'Cebra', 'C√°diz', 'Coco', 'Caja', 'Celeste', 'Cano', 'Cenicienta', 'C. Ronaldo', 'Col√≥n'],
        'D': ['Daniel', 'Delf√≠n', 'Dub√°i', 'Donut', 'Dado', 'Dorado', 'D√≠az', 'Dumbo', 'Dua Lipa', 'Dal√≠'],
        'E': ['Elena', 'Erizo', 'Espa√±a', 'Elote', 'Espejo', 'Esmeralda', 'Espinosa', 'Elsa', 'Einstein', 'Edison'],
        'F': ['Felipe', 'Foca', 'Francia', 'Flan', 'Foco', 'Fucsia', 'Flores', 'Flash', 'Frida Kahlo', 'Franco'],
        'G': ['Gael', 'Gato', 'Granada', 'Gominola', 'Gorra', 'Gris', 'Garc√≠a', 'Gandalf', 'Goya', 'Galileo'],
        'H': ['Hugo', 'Halc√≥n', 'Huelva', 'Huevo', 'Hilo', 'Humo', 'Herrera', 'Hulk', 'Harry Potter', 'Hitler'],
        'I': ['Ismael', 'Iguana', 'Italia', 'Iceberg', 'Im√°n', '√çndigo', 'Iglesias', 'Iron Man', 'Ibai', 'Isabel I'],
        'J': ['Juan', 'Jirafa', 'Ja√©n', 'Jam√≥n', 'Jarra', 'Jade', 'Jim√©nez', 'Joker', 'J. Bieber', 'Juana de Arco'],
        'L': ['Lola', 'Lobo', 'Lugo', 'Lim√≥n', 'L√°piz', 'Lila', 'L√≥pez', 'Legolas', 'Lady Gaga', 'Da Vinci'],
        'M': ['Mario', 'Mono', 'Madrid', 'Menta', 'Mesa', 'Marr√≥n', 'Mar√≠n', 'Mickey', 'Messi', 'Mozart'],
        'N': ['Nora', 'Nutria', 'Noruega', 'Nuez', 'Nube', 'Negro', 'Nieto', 'Naruto', 'Nadal', 'Napole√≥n'],
        'O': ['Oscar', 'Oveja', 'Oslo', 'Orujo', 'Olla', 'Oro', 'Ortiz', 'Olaf', 'O. Osbourne', 'Octavio'],
        'P': ['Pedro', 'Pato', 'Par√≠s', 'Pizza', 'Pala', 'Plata', 'P√©rez', 'Popeye', 'Piqu√©', 'Plat√≥n'],
        'R': ['Ra√∫l', 'Rana', 'Roma', 'Regaliz', 'Reloj', 'Rojo', 'Ruiz', 'Ryu', 'Rihanna', 'Rembrandt'],
        'S': ['Sara', 'Sapo', 'Sevilla', 'Sopa', 'Silla', 'Salm√≥n', 'Sanz', 'Shrek', 'Shakira', 'S√≥crates'],
        'T': ['Teresa', 'Tigre', 'Teruel', 'Tarta', 'Taza', 'Turquesa', 'Torres', 'Thor', 'T. Swift', 'Trajano'],
        'V': ['V√≠ctor', 'Vaca', 'Vigo', 'Vino', 'Vela', 'Verde', 'Vila', 'Voldemort', 'V. Diesel', 'Van Gogh']
    };

    const ALPHABET = Object.keys(EXAMPLES_DATA);

    let state = {
        players: [],
        mode: 'app',
        difficulty: 'easy',
        currentLetter: '',
        timer: 0,
        timerId: null,
        tempRoundScores: {}
    };

    function toggleModal(show) { document.getElementById('modal-help').classList.toggle('hidden', !show); }

    function addPlayer() {
        const input = document.getElementById('player-name-input');
        const name = input.value.trim();
        if (name) {
            state.players.push({ name: name, score: 0 });
            input.value = '';
            renderPlayers();
        }
    }

    function renderPlayers() {
        const list = document.getElementById('player-list');
        list.innerHTML = '';
        state.players.forEach((p, idx) => {
            const el = document.createElement('div');
            el.style = "background:#eef2ff; padding:5px 12px; border-radius:2rem; border:1px solid var(--primary-light); font-size:0.8rem; display:flex; align-items:center";
            el.innerHTML = `<span>${p.name}</span> <span style="margin-left:8px; cursor:pointer; font-weight:bold" onclick="removePlayer(${idx})">√ó</span>`;
            list.appendChild(el);
        });
    }

    function removePlayer(idx) { state.players.splice(idx, 1); renderPlayers(); }

    function setMode(m) {
        state.mode = m;
        document.getElementById('mode-app').classList.toggle('active-selection', m === 'app');
        document.getElementById('mode-paper').classList.toggle('active-selection', m === 'paper');
    }

    function setDiff(d) {
        state.difficulty = d;
        document.getElementById('diff-easy').classList.toggle('active-selection', d === 'easy');
        document.getElementById('diff-hard').classList.toggle('active-selection', d === 'hard');
        updateTablePreview();
    }

    function generateTableHTML(categories, examplesArray = null) {
        let head = "<thead><tr>";
        let body = "<tbody><tr>";
        let exRow = "";

        categories.forEach((cat, idx) => {
            head += `<th class="col-${idx}">${cat}</th>`;
            body += `<td class="col-${idx}">${state.currentLetter || '?'}</td>`;
        });
        head += "</tr></thead>";
        body += "</tr>";

        if (examplesArray) {
            exRow = '<tr class="example-row">';
            categories.forEach((_, idx) => {
                exRow += `<td class="col-${idx}">Ej: ${examplesArray[idx] || '-'}</td>`;
            });
            exRow += "</tr>";
        }
        
        body += exRow + "</tbody>";
        return head + body;
    }

    function updateTablePreview() {
        const table = document.getElementById('table-setup-preview');
        table.innerHTML = generateTableHTML(CATS_DATA[state.difficulty]);
    }

    function startRound() {
        if (state.players.length === 0) return alert("A√±ade jugadores");

        state.currentLetter = ALPHABET[Math.floor(Math.random() * ALPHABET.length)];
        state.timer = 0;
        
        document.getElementById('display-letter').textContent = state.currentLetter;
        document.getElementById('display-timer').textContent = "00s";
        
        document.getElementById('active-game-table').innerHTML = generateTableHTML(CATS_DATA[state.difficulty]);

        const container = document.getElementById('game-inputs-container');
        container.innerHTML = '';
        if (state.mode === 'app') {
            CATS_DATA[state.difficulty].forEach((cat, idx) => {
                const div = document.createElement('div');
                div.style = "display:flex; flex-direction:column; gap:4px";
                div.innerHTML = `<label style="font-size:0.7rem; font-weight:bold; color:var(--text-muted)">${cat}</label>
                                 <input type="text" style="padding:0.6rem; border-radius:0.4rem; border:2px solid #e5e7eb" placeholder="...">`;
                container.appendChild(div);
            });
        }

        updateSummary();
        switchView('view-game');

        state.timerId = setInterval(() => {
            state.timer++;
            document.getElementById('display-timer').textContent = state.timer.toString().padStart(2, '0') + "s";
        }, 1000);
    }

    function stopGame() {
        clearInterval(state.timerId);
        prepareScoring();
        switchView('view-scoring');
    }

    function prepareScoring() {
        const list = document.getElementById('players-scoring-list');
        list.innerHTML = '';
        state.tempRoundScores = {};
        
        // Tabla con ejemplos integrados
        const scoringTable = document.getElementById('scoring-table-examples');
        scoringTable.innerHTML = generateTableHTML(CATS_DATA[state.difficulty], EXAMPLES_DATA[state.currentLetter]);

        state.players.forEach((p, idx) => {
            state.tempRoundScores[idx] = 0;
            const div = document.createElement('div');
            div.style = "border: 2px solid #e5e7eb; padding: 0.8rem; border-radius: 1rem; margin-bottom: 0.8rem; background:#fff";
            div.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center">
                    <strong>üë§ ${p.name}</strong>
                    <span id="score-val-${idx}" style="font-weight:bold; color:var(--primary)">0 pts</span>
                </div>
                <div class="flex" style="margin-top:8px; align-items:center; justify-content:space-between">
                     <input type="number" style="width:70px; padding:6px; border-radius:6px; border:1px solid #ccc" value="0" 
                               oninput="updatePlayerRoundScore(${idx}, this.value)" id="manual-score-${idx}">
                     <div class="flex">
                        <button class="btn btn-outline" style="padding:5px 10px; font-size:0.75rem" onclick="addQuickScore(${idx}, 5)">+5</button>
                        <button class="btn btn-outline" style="padding:5px 10px; font-size:0.75rem" onclick="addQuickScore(${idx}, 10)">+10</button>
                        <button class="btn btn-outline" style="padding:5px 10px; font-size:0.75rem" onclick="addQuickScore(${idx}, 20)">+20</button>
                     </div>
                </div>
            `;
            list.appendChild(div);
        });
    }

    function addQuickScore(playerIdx, amount) {
        const input = document.getElementById(`manual-score-${playerIdx}`);
        input.value = (parseInt(input.value) || 0) + amount;
        updatePlayerRoundScore(playerIdx, input.value);
    }

    function updatePlayerRoundScore(idx, val) {
        state.tempRoundScores[idx] = parseInt(val) || 0;
        document.getElementById(`score-val-${idx}`).textContent = state.tempRoundScores[idx] + " pts";
    }

    function savePointsAndNext() {
        state.players.forEach((p, idx) => p.score += state.tempRoundScores[idx]);
        startRound();
    }

    function finishGame() {
        state.players.forEach((p, idx) => p.score += state.tempRoundScores[idx]);
        const ranking = document.getElementById('final-rankings');
        ranking.innerHTML = '';
        const sorted = [...state.players].sort((a, b) => b.score - a.score);
        sorted.forEach((p, i) => {
            ranking.innerHTML += `<div class="score-entry"><span>${i+1}. ${p.name}</span> <strong>${p.score} pts</strong></div>`;
        });
        switchView('view-winner');
    }

    function updateSummary() {
        const sum = document.getElementById('active-players-summary');
        sum.innerHTML = '<small style="color:var(--text-muted)">MARCADOR ACTUAL:</small>';
        [...state.players].sort((a,b) => b.score-a.score).forEach(p => {
            sum.innerHTML += `<div class="score-entry"><span>${p.name}</span> <span>${p.score} pts</span></div>`;
        });
        sum.classList.remove('hidden');
    }

    function switchView(id) {
        ['view-setup', 'view-game', 'view-scoring', 'view-winner'].forEach(v => document.getElementById(v).classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function restartEverything() {
        state.players = [];
        document.getElementById('active-players-summary').classList.add('hidden');
        renderPlayers();
        switchView('view-setup');
    }

    // Init
    setMode('app');
    setDiff('easy');
</script>
</body>
</html>